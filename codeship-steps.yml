- type: parallel # parallel causes a race condition when test runs
  steps:
    - name: checkrb
      service: demo
      command: bundle exec ruby check.rb
    - type: serial
      steps:
      - name: test
        service: demo
        command: bundle exec ruby test.rb
      - name: volumes_in
        service: demo
        command: bundle exec ruby write.rb
      - name: volumes_out
        service: demo
        command: bundle exec ruby read.rb

- type: serial
  steps:
    - name: awspush
      service: demo
      type: push
      image_name: 952671759649.dkr.ecr.us-west-2.amazonaws.com/demo
      registry: https://952671759649.dkr.ecr.us-west-2.amazonaws.com
      dockercfg_service: dockercfg_generator